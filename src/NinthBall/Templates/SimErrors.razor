@using NinthBall.Core;

<h1>Something went wrong</h1>

@if(Ex is FatalWarning)
{
    <h3>@Ex.Message</h3>
}
else
{
    // Print root cause
    <h3>@FindRootCause(Ex)</h3>

    // If this is an error-chain, print chain of error messages
    if (null != Ex.InnerException)
    {
        <h4>Errors:</h4>
        <div>
            <ul>
                @foreach (var msg in InnerMessages(Ex))
                {
                    <li>@msg</li>
                }
            </ul>
        </div>
    }

    // Error details
    <h4>Details:</h4>
    <pre>
        @Ex.ToString()
    </pre>
}

@code {

    [Parameter] public Exception Ex { get; set; } = null!;

    static string FindRootCause(Exception err)
    {
        var rootCause = string.Empty;

        while(null != err)
        {
            rootCause = err.Message;
            err = err.InnerException!;
        }

        return rootCause;
    }

    static IEnumerable<string> InnerMessages(Exception err) 
    {
        while(null != err) 
        {
            yield return err.Message;
            err = err.InnerException!;
        }
    }
}