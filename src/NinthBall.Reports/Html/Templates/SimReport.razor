@using System;
@using NinthBall.Core;
@using NinthBall.Reports;
@using System.Reflection

<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Report</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <style>
        .mono-space {
            font-family: monospace;
            white-space: pre;   /* Preserves the exact whitespace generated by C# padding */
        }

        .page-break {
            break-before: page; /* same as page-break-before: always */
        }

        .section {
            break-inside: avoid; /* prevents splitting across pages */
        }

        /* Pure CSS Styled Tooltip */
        .nb-tooltip {
            position: relative;
            cursor: help;
        }

        .nb-tooltip::after {
            content: attr(data-nb-title);
            position: absolute;
            bottom: 110%;
            left: 50%;
            transform: translateX(-50%);
            background-color: #212529; /* Bootstrap Dark */
            color: #fff;
            padding: 4px 8px;
            border-radius: 4px;
            white-space: pre-wrap;
            width: max-content;
            max-width: 200px;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s ease-in-out;
            font-size: 0.75rem;
            font-family: var(--bs-font-sans-serif);
            font-weight: normal;
            z-index: 1070;
            box-shadow: 0 .5rem 1rem rgba(0,0,0,.15);
            line-height: 1.2;
            text-align: center;
        }

        .nb-tooltip:hover::after {
            opacity: 1;
            visibility: visible;
        }

        /* Tooltip arrow */
        .nb-tooltip::before {
            content: "";
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 5px solid transparent;
            border-top-color: #212529;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s ease-in-out;
            z-index: 1070;
        }

        .nb-tooltip:hover::before {
            opacity: 1;
            visibility: visible;
        }

        @@media print {
            @@page {
                size: landscape;
                margin: 1cm;
            }

            /* Force accordions/collapse open */
            .collapse:not(.show), .accordion-collapse:not(.show) {
                display: block !important;
                height: auto !important;
            }

            /* Stack tabs vertically for print */
            .nav {
                display: none !important; /* Hide the tab navigation */
            }

            .tab-content > .tab-pane {
                display: block !important;
                opacity: 1 !important;
                break-before: page;
            }

            /* Ensure the first one doesn't have a leading blank page */
            .tab-content > .tab-pane:first-child {
                break-before: auto;
            }

            /* Hide tooltips in print */
            .nb-tooltip::after, .nb-tooltip::before {
                display: none !important;
            }

            /* Repeating headers and row stability */
            thead { display: table-header-group; }
            tr { break-inside: avoid; }
        }
    </style>
</head>

<body>
    <div class="container-fluid">

        <CascadingValue Value="@SimResult">
        <CascadingValue Value="@Columns" Name="Columns">
        <CascadingValue Value="@Percentiles" Name="Percentiles">
        <CascadingValue Value="@Iterations" Name="Iterations">
            <div>
                <SimParameters />
                <SimSurvival />
                <SimPercentilesSummary />
                <SimIterationTabs TargetPercentile=TargetPercentile />
            </div>
        </CascadingValue>
        </CascadingValue>
        </CascadingValue>
        </CascadingValue>


        <span class="mt-4 p-2" >
            <small class="text-secondary">
                Ver: @(AppVersion?.ToString() ?? "N/A")
            </small>
        </span>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>

    </div>
</body>
</html>

@code
{
    [Parameter] public SimResult SimResult { get; set; } = null!;
    [Parameter] public IReadOnlyList<CID> Columns { get; set; } = [];
    [Parameter] public IReadOnlyList<double> Percentiles { get; set; } = [];
    [Parameter] public IReadOnlyList<int> Iterations { get; set; } = [];
    [Parameter] public double TargetPercentile { get; set; } = 0.2;

    System.Version? AppVersion => Assembly.GetEntryAssembly()?.GetName()?.Version;
}